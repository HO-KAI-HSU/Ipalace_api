"use strict";(self["webpackChunknpm_frontend"]=self["webpackChunknpm_frontend"]||[]).push([[602],{2587:function(e,s,t){t.d(s,{Z:function(){return u}});var a=function(){var e=this,s=e._self._c;return s("div",{staticClass:"main"},[s("div",{staticClass:"row refCourse"},[s("div",{staticClass:"container"},[s("h4",[e._v("推薦課程")]),s("LessonSlider",{attrs:{loader:e.load}})],1)])])},r=[],n=t(2293),o={components:{LessonSlider:n.Z},methods:{load(){return this.$api.getRecommand()}}},i=o,l=t(1001),c=(0,l.Z)(i,a,r,!1,null,null,null),u=c.exports},9602:function(e,s,t){t.r(s),t.d(s,{default:function(){return p}});var a=function(){var e=this,s=e._self._c;return e.Lesson&&e.Chapter?s("div",[s("div",{staticClass:"courseVideo"},[s("div",{staticClass:"videoContent",attrs:{id:"vid-cont"}},[s("video",{attrs:{src:e._f("imageCDN")(e.Chapter.VideoUrl),controls:"",width:"100%"},on:{play:e.onplay,pause:e.onpause,timeupdate:e.onprogress,ended:e.onended}}),s("div",{staticClass:"backToCourse"},[s("router-link",{attrs:{to:`/lesson/${e.Lesson.LessonID}`}},[e._v("返回課程")])],1),s("div",{staticClass:"className"},[e._v(e._s(e.Chapter.ChapterName))]),e.User?e._e():s("div",{staticClass:"blockVideo"})]),s("div",{staticClass:"container"},[s("div",{staticClass:"courseContent"},[s("div",{staticClass:"goBackCourse"},[s("router-link",{attrs:{to:`/lesson/${e.Lesson.LessonID}`}},[s("img",{attrs:{src:"/img/goBack.svg"}}),e._v("返回課程")])],1),s("h3",[e._v(e._s(e.Chapter.ChapterName))]),s("div",{staticClass:"c_student"},[s("h4",[e._v("課程章節")]),s("div",{staticClass:"contentBox"},[e.Lesson.HasChapterSubject?s("div",{staticClass:"chapters"},[s("h5",[e._v(e._s(e.Lesson.ChapterTitle))]),e._l(e.Subjects,(function(t){return[s("h6",{key:t.ID},[e._v(e._s(t.Name))]),s("div",{key:t.ID,staticClass:"ch_list"},[s("ol",e._l(t.Chapters,(function(t){return s("li",{key:t.LessonChapterID,class:{act:t.LessonChapterID==e.$route.params.id}},[s("router-link",{attrs:{to:`/lesson/chapter/${t.LessonChapterID}`}},[s("b",{staticClass:"ch_name"},[e._v(e._s(t.ChapterName)+" "),t.Learned?[e._v("(已觀看)")]:e._e()],2),s("span",{staticClass:"time"},[e._v(e._s(e._f("mmss")(t.VideoLength)))])])],1)})),0)])]}))],2):s("div",{staticClass:"chapters"},[s("h5",[e._v(e._s(e.Lesson.ChapterTitle))]),s("div",{staticClass:"ch_list"},[s("ol",e._l(e.Chapters,(function(t){return s("li",{key:t.LessonChapterID,class:{act:t.LessonChapterID==e.$route.params.id}},[s("router-link",{attrs:{to:`/lesson/chapter/${t.LessonChapterID}`}},[s("b",{staticClass:"ch_name"},[e._v(e._s(t.ChapterName)+" "),t.Learned?[e._v("(已觀看)")]:e._e()],2),s("span",{staticClass:"time"},[e._v(e._s(e._f("mmss")(t.VideoLength)))])])],1)})),0)])])])])])])]),s("Recommand"),e.Student&&e.Student.IsLearning?s("div",{staticClass:"fixBottom"},[s("div",{staticClass:"container"},[s("router-link",{class:{off:!e.Student.Prev},attrs:{to:`/lesson/${e.Student.Prev}`}},[e._v("上一堂課")]),e.HasHomeWork&&100==e.Progress?s("router-link",{staticClass:"goWork",attrs:{to:`/homework/${e.Lesson.LessonID}`}},[e._v("課程習題")]):e._e(),s("router-link",{class:{off:!e.Student.Next},attrs:{to:`/lesson/${e.Student.Next}`}},[e._v("下一堂課")])],1)]):e._e()],1):e._e()},r=[],n=(t(7658),t(2587)),o=t(381),i=t.n(o),l=0,c={components:{Recommand:n.Z},data(){return{User:null,Lesson:null,Chapters:[],Chapter:null,Student:null,HasHomeWork:!0,Progress:0,Subjects:[]}},mounted(){this.load(),document.addEventListener("fullscreenchange",this.onleavefullscreen)},methods:{async load(){this.Subjects=[],this.User=this.$user.user;var e=await this.$api.getLessonChapters(this.$route.params.id);this.Lesson=e.Lesson;var s={};if(e.Chapters.forEach((e=>{e.Learned=!1,s[e.LessonChapterID]=e})),this.Chapters=e.Chapters,this.Chapter=e.Chapters.filter((e=>e.LessonChapterID==this.$route.params.id))[0],this.Lesson.HasChapterSubject){var t={};this.Chapters.forEach((e=>{var s=e.LessonSubjectID;t[s]||(t[s]=[]),t[s].push(e)})),this.Lesson.ChapterSubjects.forEach((e=>{e.Chapters=t[e.ID],this.Subjects.push(e)}))}if(this.$user.user){var a=await this.$api.getChapterProgress(this.$route.params.id);if(a&&this.$nextTick((()=>document.querySelector("video").currentTime=a.Time)),2==this.$user.user.Type){var r=this.Lesson.LessonID;e=await this.$api.getClassRoomByLessonID(r),this.Progress=e.MemberLesson.Progress;var n=e.ClassRoom;if(i()().isBetween(n.StartTime,n.EndTime)){var o=n.Lessons.indexOf(r),l={IsLearning:!0,Prev:null,Next:null};-1!=o&&(o>0&&(l.Prev=n.Lessons[o-1]),o<n.Lessons.length-1&&(l.Next=n.Lessons[o+1])),this.Student=l,this.Lesson.HasHomeWork&&n.HasHomeWork&&-1!=n.HomeWorks.indexOf(r)||(this.HasHomeWork=!1)}else this.Student={IsLearning:!1};var c=await this.$api.learn(this.$route.params.id);this.Progress=c;var u=await this.$api.getLearnedChapter(r);u.forEach((e=>{s[e.LessonChapterID]&&(s[e.LessonChapterID].Learned=!0)}))}}},fullscreen(){document.fullscreenElement?document.exitFullscreen&&(document.exitFullscreen(),$("#vid-cont").removeClass("fs")):(document.getElementById("vid-cont").requestFullscreen(),$("#vid-cont").addClass("fs"))},onplay(){console.log("play"),document.getElementById("vid-cont").requestFullscreen(),$("#vid-cont").addClass("fs")},onpause(){console.log("pause"),document.exitFullscreen(),$("#vid-cont").removeClass("fs")},onprogress(e){if(console.log("progress:",e),this.$user.user){var s=(new Date).getTime();s-l>1e3&&(this.$api.updateChapterProgress({LessonChapterID:this.$route.params.id,Time:document.querySelector("video").currentTime,Done:!1}),l=s)}},onleavefullscreen(e){console.log(e),document.fullscreenElement||document.querySelector("video").pause()},onended(e){this.$user.user&&this.FirstChapter&&this.$api.updateChapterProgress({LessonChapterID:this.$route.params.id,Time:document.querySelector("video").currentTime,Done:!0})}},watch:{$route(){this.load(),this.$nextTick((()=>{$("html, body").animate({scrollTop:0},"slow")}))}},beforeRouteLeave(e,s,t){document.removeEventListener("fullscreenchange",this.onleavefullscreen),t()}},u=c,h=t(1001),d=(0,h.Z)(u,a,r,!1,null,null,null),p=d.exports}}]);
//# sourceMappingURL=602.d111022c.js.map