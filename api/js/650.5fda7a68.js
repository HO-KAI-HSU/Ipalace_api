"use strict";(self["webpackChunknpm_frontend"]=self["webpackChunknpm_frontend"]||[]).push([[650],{2587:function(s,e,t){t.d(e,{Z:function(){return h}});var a=function(){var s=this,e=s._self._c;return e("div",{staticClass:"main"},[e("div",{staticClass:"row refCourse"},[e("div",{staticClass:"container"},[e("h4",[s._v("推薦課程")]),e("LessonSlider",{attrs:{loader:s.load}})],1)])])},r=[],n=t(2293),i={components:{LessonSlider:n.Z},methods:{load(){return this.$api.getRecommand()}}},o=i,l=t(1001),c=(0,l.Z)(o,a,r,!1,null,null,null),h=c.exports},9650:function(s,e,t){t.r(e),t.d(e,{default:function(){return p}});var a=function(){var s=this,e=s._self._c;return e("div",[s.Lesson?e("div",{staticClass:"courseVideo"},[e("div",{staticClass:"videoContent",attrs:{id:"vid-cont"}},[e("video",{attrs:{src:s._f("imageCDN")(s.FirstChapter.VideoUrl),controls:"",width:"100%"},on:{play:s.onplay,pause:s.onpause,timeupdate:s.onprogress,ended:s.onended}}),e("div",{staticClass:"backToCourse"},[e("a",{attrs:{href:"javascript:void(0)"},on:{click:s.fullscreen}},[s._v("返回課程")])]),e("div",{staticClass:"fullscreen-button",on:{click:s.fullscreen}},[e("img",{attrs:{src:"/img/fullscreen.svg"}})]),e("div",{staticClass:"className"},[s._v(s._s(s.FirstChapter.ChapterName))]),s.User?s._e():e("div",{staticClass:"blockVideo",on:{click:s.login}})]),e("div",{staticClass:"container"},[e("div",{staticClass:"courseContent"},[e("div",{staticClass:"c_title courseInfo"},[e("img",{staticClass:"doll",attrs:{src:"/img/doll.png"}}),1==s.Lesson.LessonCategoryID?e("div",{staticClass:"cateTag"},[s._v("師培課程")]):e("div",{staticClass:"cateTag"},[s._v("學生課程")]),e("div",{staticClass:"time"},[e("img",{attrs:{src:"/img/action.png"}}),s._v(s._s(s._f("chhmmss")(s.Lesson.VideoLength))+" ")])]),e("h3",[s._v(s._s(s.Lesson.LessonName))]),s.$user.user?e("div",{staticClass:"c_student"},[e("h4",[s._v("課程章節")]),e("div",{staticClass:"contentBox"},[s.Lesson.HasChapterSubject?e("div",{staticClass:"chapters"},[e("h5",[s._v(s._s(s.Lesson.ChapterTitle))]),s._l(s.Subjects,(function(t,a){return[e("h6",{key:t.ID},[s._v(s._s(t.Name))]),e("div",{key:t.ID,staticClass:"ch_list"},[e("ol",s._l(t.Chapters,(function(t,r){return e("li",{key:t.LessonChapterID,class:{act:0==r&&0==a}},[e("router-link",{attrs:{to:`/lesson/chapter/${t.LessonChapterID}`}},[e("b",{staticClass:"ch_name"},[s._v(s._s(t.ChapterName)+" "),t.Learned?[s._v("(已觀看)")]:s._e()],2),e("span",{staticClass:"time"},[s._v(s._s(s._f("mmss")(t.VideoLength)))])])],1)})),0)])]}))],2):e("div",{staticClass:"chapters"},[e("h5",[s._v(s._s(s.Lesson.ChapterTitle))]),e("div",{staticClass:"ch_list"},[e("ol",s._l(s.Chapters,(function(t,a){return e("li",{key:t.LessonChapterID,class:{act:0==a}},[e("router-link",{attrs:{to:`/lesson/chapter/${t.LessonChapterID}`}},[e("b",{staticClass:"ch_name"},[s._v(s._s(t.ChapterName))]),e("span",{staticClass:"time"},[s._v(s._s(s._f("mmss")(t.VideoLength)))])])],1)})),0)])])])]):s._e(),e("div",{staticClass:"c_intro"},[e("h4",[s._v("課程簡介")]),e("div",{staticClass:"contentBox",domProps:{innerHTML:s._s(s.Lesson.Brief)}})]),e("div",{staticClass:"c_target"},[e("h4",[s._v("課程目標")]),e("div",{staticClass:"contentBox",domProps:{innerHTML:s._s(s.Lesson.Goal)}})]),e("div",{staticClass:"c_student"},[e("h4",[s._v("課程對象")]),e("div",{staticClass:"contentBox",domProps:{innerHTML:s._s(s.Lesson.Target)}})]),s.$user.user?s._e():e("div",{staticClass:"c_student"},[e("h4",[s._v("課程章節")]),e("div",{staticClass:"contentBox"},[s.Lesson.HasChapterSubject?e("div",{staticClass:"chapters"},[e("h5",[s._v(s._s(s.Lesson.ChapterTitle))]),s._l(s.Subjects,(function(t,a){return[e("h6",{key:t.ID},[s._v(s._s(t.Name))]),e("div",{key:t.ID,staticClass:"ch_list"},[e("ol",s._l(t.Chapters,(function(t,r){return e("li",{key:t.LessonChapterID,class:{act:0==r&&0==a}},[e("router-link",{attrs:{to:`/lesson/chapter/${t.LessonChapterID}`}},[e("b",{staticClass:"ch_name"},[s._v(s._s(t.ChapterName))]),e("span",{staticClass:"time"},[s._v(s._s(s._f("mmss")(t.VideoLength)))])])],1)})),0)])]}))],2):e("div",{staticClass:"chapters"},[e("h5",[s._v(s._s(s.Lesson.ChapterTitle))]),e("div",{staticClass:"ch_list"},[e("ol",s._l(s.Chapters,(function(t,a){return e("li",{key:t.LessonChapterID,class:{act:0==a}},[e("router-link",{attrs:{to:`/lesson/chapter/${t.LessonChapterID}`}},[e("b",{staticClass:"ch_name"},[s._v(s._s(t.ChapterName))]),e("span",{staticClass:"time"},[s._v(s._s(s._f("mmss")(t.VideoLength)))])])],1)})),0)])])])]),e("div",{staticClass:"shareBox"},[e("p",[s._v("課程分享")]),e("div",{staticClass:"shareLinks"},[e("a",{attrs:{href:"http://www.facebook.com/share.php?u="+s.ShareUrl,target:"_blank"}},[e("img",{attrs:{src:"/img/icon_fb.png",alt:""}})]),s._e(),e("a",{attrs:{href:"https://social-plugins.line.me/lineit/share?url="+s.ShareUrl,target:"_blank"}},[e("img",{attrs:{src:"/img/icon_line.png",alt:""}})])])])])])]):s._e(),e("Recommand"),s.Student&&s.Student.IsLearning?e("div",{staticClass:"fixBottom"},[e("div",{staticClass:"container"},[e("router-link",{class:{off:!s.Student.Prev},attrs:{to:`/lesson/${s.Student.Prev}`}},[s._v("上一堂課")]),s.HasHomeWork&&100==s.Progress?e("router-link",{staticClass:"goWork",attrs:{to:`/homework/${s.Lesson.LessonID}`}},[s._v("課程習題")]):s._e(),e("router-link",{class:{off:!s.Student.Next},attrs:{to:`/lesson/${s.Student.Next}`}},[s._v("下一堂課")])],1)]):s._e()],1)},r=[],n=(t(7658),t(2587)),i=t(381),o=t.n(i),l=0,c={components:{Recommand:n.Z},metaInfo(){return{title:this.metaTitle}},data(){return{User:null,Lesson:null,Chapters:[],Student:null,HasHomeWork:!0,Subjects:[],Progress:0,metaTitle:"故宮線上學校"}},async mounted(){this.User=this.$user.user,this.load(),document.addEventListener("fullscreenchange",this.onleavefullscreen)},methods:{async load(){var s=parseInt(this.$route.params.id),e=await this.$api.getFullLesson(s);this.Lesson=e.Lesson,this.metaTitle=e.Lesson.LessonName+" - 故宮線上學校";var t={};if(e.Chapters.forEach((s=>{s.Learned=!1,t[s.LessonChapterID]=s})),this.Chapters=e.Chapters,this.Lesson.HasChapterSubject){var a={};this.Chapters.forEach((s=>{var e=s.LessonSubjectID;a[e]||(a[e]=[]),a[e].push(s)})),this.Lesson.ChapterSubjects.forEach((s=>{s.Chapters=a[s.ID],this.Subjects.push(s)}))}if(this.$user.user){await this.$api.visit(s);var r=await this.$api.getChapterProgress(this.FirstChapter.LessonChapterID);if(r&&this.$nextTick((()=>document.querySelector("video").currentTime=r.Time)),2==this.$user.user.Type){e=await this.$api.getClassRoomByLessonID(s),this.Progress=e.MemberLesson.Progress;var n=e.ClassRoom;if(o()().isBetween(n.StartTime,n.EndTime)){var i=n.Lessons.indexOf(s),l={IsLearning:!0,Prev:null,Next:null};-1!=i&&(i>0&&(l.Prev=n.Lessons[i-1]),i<n.Lessons.length-1&&(l.Next=n.Lessons[i+1])),this.Student=l,this.Lesson.HasHomeWork&&n.HasHomeWork&&-1!=n.HomeWorks.indexOf(s)||(this.HasHomeWork=!1)}else this.Student={IsLearning:!1};var c=await this.$api.learn(this.FirstChapter.LessonChapterID);this.Progress=c;var h=await this.$api.getLearnedChapter(s);h.forEach((s=>{t[s.LessonChapterID]&&(t[s.LessonChapterID].Learned=!0)}))}}},fullscreen(){document.fullscreenElement?document.exitFullscreen&&(document.exitFullscreen(),$("#vid-cont").removeClass("fs")):(document.getElementById("vid-cont").requestFullscreen(),$("#vid-cont").addClass("fs"))},login(){alert("請先登入"),this.$router.push("/login")},onplay(){console.log("play"),document.getElementById("vid-cont").requestFullscreen(),$("#vid-cont").addClass("fs")},onpause(){console.log("pause"),document.exitFullscreen(),$("#vid-cont").removeClass("fs")},onprogress(s){if(console.log("progress:",s),this.$user.user&&this.FirstChapter){var e=(new Date).getTime();e-l>1e3&&(this.$api.updateChapterProgress({LessonChapterID:this.FirstChapter.LessonChapterID,Time:document.querySelector("video").currentTime,Done:!1}),l=e)}},onleavefullscreen(s){console.log(s),document.fullscreenElement||document.querySelector("video").pause()},onended(s){this.$user.user&&this.FirstChapter&&this.$api.updateChapterProgress({LessonChapterID:this.FirstChapter.LessonChapterID,Time:document.querySelector("video").currentTime,Done:!0})}},computed:{FirstChapter(){return this.Chapters.length>0?this.Chapters[0]:null},ShareUrl(){return encodeURIComponent(config.host+"/api/lesson/share/"+this.$route.params.id)}},watch:{$route(){this.load(),this.$nextTick((()=>{$("html, body").animate({scrollTop:0},"slow")}))}},beforeRouteLeave(s,e,t){document.removeEventListener("fullscreenchange",this.onleavefullscreen),t()}},h=c,u=t(1001),d=(0,u.Z)(h,a,r,!1,null,null,null),p=d.exports}}]);
//# sourceMappingURL=650.5fda7a68.js.map